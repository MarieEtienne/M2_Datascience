<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Analyse de la variance</title>
    <meta charset="utf-8" />
    <meta name="author" content="Marie-Pierre Etienne" />
    <script src="libs/header-attrs-2.4/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link rel="stylesheet" href="mpe_pres.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Analyse de la variance
## √† 1 facteur
### Marie-Pierre Etienne
### <a href="https://github.com/marieetienne" class="uri">https://github.com/marieetienne</a>
### 2020/09/11 (updated: 2020-10-05)

---










name: intro
# Introduction

---
template: intro
## Un exemple jouet √† but p√©dagogique

On a mesur√© la fr√©quence cardiaque de 20 femmes et 20 hommes.





```r
library(coursesdata)
data(freqdata)
```

&lt;img src="anova_files/figure-html/freqdata-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


--
&lt;p class="question"&gt; Les hommes et les femmes ont-ils la m√™me fr√©quence cardiaque au repos ?&lt;/p&gt;

---
template: intro
## Cas d'√©tude Chauve souris

- Des esp√®ces avec diff√©rents r√©gimes alimentaires.
- L'√©cho localisation (capacit√© auditive) est un sens essentiel pour les insectivores.

Hutcheon, Kirsch, and Garland [HKG02] ont recens√© pour 63 esp√®ces de chauves souris l'esp√®ce, le r√©gime alimentaire, le clade (groupe dans l'arbre phylog√©n√©tique), diff√©rentes variables morphologiques dont le volume du cerveau d√©di√© √† l'audition (AUD)

&lt;img src="anova_files/figure-html/batsdata-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

--
&lt;p class="question"&gt; Le volume de la partie auditive du cerveau est il li√© au r√©gime alimentaire ?&lt;/p&gt;

---
template: intro
## Cadre g√©n√©ral du mod√®le d'analyse de la variance √† 1 facteur
On √©tudie le lien entre  
- variable quantitative not√©e `\(Y\)` (la fr√©quence cardiaque, volume de cerveau),
- et une variable qualitative (un facteur) pourvant prendre `\(I\)` modalit√©s (I=2 pour l'exemple 1 et I=4 dans l'exemple 2). 


Les donn√©es peuvent √™tre visualis√©es √† l'aide d'un boxplot.


--
&lt;p class="question"&gt; La variable d'int√©r√™t Y  est-elle en moyenne diff√©rente selon les diff√©rentes modalit√©s ?&lt;/p&gt;



---
name: model
# Le mod√®le d'analyse de la variance √† 1 facteur

---
template: model

## Graphiquement 

Une visalisation graphique du mod√®le d'analyse de la variance.

&lt;br&gt; &lt;br&gt; &lt;br&gt; &lt;br&gt;


Comment imagine-t-on le processus al√©atoire qui a conduit √† nos donn√©es ?


---





count: false

&lt;img src="anova_files/figure-html/anova_versiongraphique_proba_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova_files/figure-html/anova_versiongraphique_proba_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova_files/figure-html/anova_versiongraphique_proba_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-anova_versiongraphique_proba-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-anova_versiongraphique_proba-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-anova_versiongraphique_proba-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;


---
count:false

&lt;img src="anova_files/figure-html/anova_versiongraphique_proba2-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;





---



count: false

&lt;img src="anova_files/figure-html/anova_versiongraphique_proba_M0_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova_files/figure-html/anova_versiongraphique_proba_M0_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-anova_versiongraphique_proba_M0-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-anova_versiongraphique_proba_M0-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-anova_versiongraphique_proba_M0-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---
count: false

&lt;img src="anova_files/figure-html/anova_versiongraphique_proba2_M0-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;
---
template: model
count: false

&lt;img src="anova_files/figure-html/anova_versiongraphique_save-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


&lt;p class="question"&gt; Au vu de nos donn√©es, le mod√®le M1 est-il plus pertinent que le mod√®le M0 ?&lt;/p&gt;



---
template: model

## Version r√©guli√®re du mod√®le M1

`$$Y_{ik} \overset{ind}{\sim}\mathcal{N}(\mu_i, \sigma^2),$$`
avec 
- `\(i=1,\ldots,I\)` le num√©ro du groupe,
- `\(k= 1,\ldots, n_i\)` le num√©ro de l'individu dans le groupe `\(i\)`, 
- `\(n_i\)` le nombre d'individus dans le groupe `\(i\)` et `\(n=\sum_i n_i\)` le nombre total d'individus,
- `\(\mu_i\)` le comportement moyen du groupe `\(i\)`,
- `\(\sigma^2\)` la variance commune √† tous les groupes.

### Une √©criture √©quivalente 

`$$Y_{ik} = \mu_{i} + E_{ik}, \quad E_{ik}\overset{ind}{\sim}\mathcal{N}(0, \sigma^2).$$`


### Nombre de param√®tres du mod√®le

- `\(I\)` param√®tres de moyenne  `\((\mu_1, \mu_2, \ldots, \mu_I)\)`; 
- 1 param√®tre de variance `\(\sigma^2\)`

---
template: model

## Version r√©guli√®re du mod√®le M1 sur l'exemple 1

`$$Y_{ik} \overset{ind}{\sim}\mathcal{N}(\mu_i, \sigma^2),$$`
avec  `\(I=2\)` et  la convention `\(i=1\)` pour les femmes et `\(i=2\)` pour les hommes.


```r
freqdata %&gt;%group_by(Sexe) %&gt;% summarise(n= n())
```

```
[90m# A tibble: 2 x 2[39m
  Sexe      n
  [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m
[90m1[39m F        20
[90m2[39m M        20
```
Ainsi 
- `\(k=1, \ldots, n_i\)`, avec `\(n_1=20\)` et `\(n_2=20\)` et `\(n=40\)`.
- `\(\mu_1\)` la fr√©quence cardiaque moyenne des femmes et `\(\mu_2\)` celle des hommes. 
- `\(\sigma^2\)` la variance commune √† tous les groupes.

### Nombre de param√®tres
- 2 param√®tres de moyenne
- 1 param√®tre de variance

---
template: model
## Version singuli√®re du mod√®le du mod√®le M1

`$$Y_{ik} \overset{ind}{\sim}\mathcal{N}(\mu + \alpha_i, \sigma^2),$$`
avec 
- `\(i=1,\ldots,I\)` le num√©ro du groupe,
- `\(k= 1,\ldots, n_i\)` le num√©ro de l'individu dans le groupe `\(i\)`, ( `\(\sum_i n_i=n\)` )
- `\(\mu\)` un comportement moyen de r√©f√©rence,
- `\(\alpha_i\)` un effet diff√©rentiel du groupe `\(i\)`par rapport √† la r√©f√©rence,
- `\(\sigma^2\)` la variance commune √† tous les groupes.

### Une √©criture √©quivalente 

`$$Y_{ik} = \mu + \alpha_{i} + E_{ik}, \quad E_{ik}\overset{ind}{\sim}\mathcal{N}(0, \sigma^2).$$`

### Nombre de param√®tres du mod√®le

- `\(I+1\)` param√®tres de moyenne `\((\mu, \alpha_1, \alpha_2, \ldots, \alpha_I)\)`,
- 1 param√®tre de variance `\(\sigma^2.\)`

--

#### La version dans les logiciels et celle qui se g√©n√©ralise √† plusieurs facteurs.

---
template: model
## Version singuli√®re du mod√®le du mod√®le M1 sur l'exemple 1

`$$Y_{ik} \overset{ind}{\sim}\mathcal{N}(\mu + \alpha_i, \sigma^2),$$`
avec 
- `\(I=2\)` et  la convention `\(i=1\)` pour les femmes et `\(i=2\)` pour les hommes.
- `\(k=1, \ldots, n_i\)`, avec `\(n_1=20\)` et `\(n_2=20\)`
- `\(\mu\)` la fr√©quence cardiaque moyenne de r√©f√©rence &lt;a class="care"&gt; R√©f√©rence √† d√©finir &lt;/a&gt; 
- `\(\alpha_1\)`, l'effet diff√©rentiel d'√™tre une femme par rapport √† la diff√©rence et `\(\alpha_2\)` l'effet diff√©rentiel d'√™tre un homme.
- `\(\sigma^2\)` la variance commune √† tous les groupes.



### Nombre de param√®tres
- 3 param√®tres de moyenne
- 1 param√®tre de variance


---
template: model
## Lien entre les deux versions du m√™me mod√®le

 &lt;table style="width:100%"&gt;
  &lt;tr&gt;
    &lt;th&gt;Groupe&lt;/th&gt;
    &lt;th&gt;V. r√©guli√®re&lt;/th&gt;
    &lt;th&gt;V. singuli√®re&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt; `\(\mu_1\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu +\alpha_1\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;2&lt;/td&gt;
    &lt;td&gt; `\(\mu_2\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu +\alpha_2\)` &lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;I&lt;/td&gt;
    &lt;td&gt; `\(\mu_I\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu +\alpha_I\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt; 

--

&lt;a class=care&gt; Probl√®me &lt;/a&gt; : Version r√©guli√®re mal d√©finie. Le mod√®le dans cette version est dit &lt;a style="font-weight:400;"&gt; ind√©termin√©&lt;/a&gt;.


--
####Exemple
Si `\(\mu_1 =10,\ \mu_2=12,\)` dans la forme singuli√®re peut correspondre √† 

- `\(\mu =10,\ \alpha_1=0, \ \alpha_2=2,\)`
- ou `\(\mu =0,\ \alpha_1=10, \ \alpha_2=12,\)`
- ou `\(\mu =11,\ \alpha_1=-1, \ \alpha_2=1,\)`
- ou `\(\mu =15,\ \alpha_1=-5, \ \alpha_2=-3,\)`
- `\(\ldots\)`


--
&lt;a class=care&gt; Solution &lt;/a&gt; : Choisir une contrainte. Par d√©faut dans R, `\(\alpha_1=0\)`. La r√©f√©rence est le comportement du groupe 1. 



---
template: model
## Version singuli√®re du mod√®le du mod√®le M1 en int√©grant la contrainte par d√©faut



`$$Y_{ik} = \mu + \alpha_{i} + E_{ik}, \quad E_{ik}\overset{ind}{\sim}\mathcal{N}(0, \sigma^2).$$`

avec 
- `\(i=1,\ldots,I\)` le num√©ro du groupe,
- `\(k= 1,\ldots, n_i\)` le num√©ro de l'individu dans le groupe `\(i\)`, ($\sum_i n_i = n$ nombre total d'individus)
- `\(\mu\)` un comportement moyen de r√©f√©rence &lt;a class=care&gt; c'est celui du groupe 1&lt;/a&gt;
- `\(\alpha_1=0\)`  la contrainte choisie, `\(\alpha_1\)` n'est plus un param√®tre d'int√©r√™t.
- `\(\alpha_i, i\geq 2\)` un effet diff√©rentiel du groupe `\(i\)`par rapport √† la r√©f√©rence(i.e. le groupe 1)
- `\(\sigma^2\)` la variance commune √† tous les groupes.


### Nombre de param√®tres du mod√®le

- `\(I\)` param√®tres de moyenne `\((\mu,  \alpha_2, \ldots, \alpha_I)\)`,
- 1 param√®tre de variance `\(\sigma^2.\)`

---
template: model
## Version singuli√®re du mod√®le du mod√®le M1 sur l'exemple 1  en int√©grant la contrainte par d√©faut

`$$Y_{ik} \overset{ind}{\sim}\mathcal{N}(\mu + \alpha_i, \sigma^2),$$`
avec 
- `\(I=2\)` et  la convention `\(i=1\)` pour les femmes et `\(i=2\)` pour les hommes.
- `\(k=1, \ldots, n_i\)`, avec `\(n_1=20\)` et `\(n_2=20\)`
- `\(\mu\)` la fr√©quence cardiaque moyenne des femmesei 
- `\(\alpha_1\)`, l'effet diff√©rentiel d'√™tre une femme par rapport √† la diff√©rence et `\(\alpha_2\)` l'effet diff√©rentiel d'√™tre un homme.
- `\(\sigma^2\)` la variance commune √† tous les groupes.



### Nombre de param√®tres
- 3 param√®tres de moyenne
- 1 param√®tre de variance


---
template: model
## Sous forme matricielle
 `$$\bf{Y = X\theta + E}$$`
### Forme r√©guli√®re 

`$${\bf{Y}} = \overset{}{\begin{pmatrix}
Y_{11}\\
Y_{12}\\
Y_{13}\\
\vdots\\
Y_{1n_1}\\
Y_{21}\\
Y_{22}\\
\vdots\\
Y_{2n_2}\\
\vdots\\
Y_{In_I}\end{pmatrix}}, \quad
{\bf{X}} =\overset{\color{gray}{\begin{matrix}\mu_1 &amp; \mu_2 &amp; \ldots &amp; \ldots &amp;\mu_I\end{matrix}}}{\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
\vdots\\
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
0 &amp; 1 &amp; 0 &amp; \ldots 0 \\
0 &amp; 1 &amp; 0 &amp; \ldots 0 \\\vdots\\
0 &amp; 1 &amp; 0 &amp; \ldots 0 \\\vdots\\
0 &amp; 0 &amp; 0 &amp; \ldots 1 \end{pmatrix}}, \quad
{\bf{\theta}} =\begin{pmatrix}
\mu_{1}\\
\mu_{2}\\
\vdots\\
\mu_I\end{pmatrix}, \quad{\bf{E}} =\begin{pmatrix}
E_{11}\\
E_{12}\\
E_{13}\\
\vdots\\
E_{1n_1}\\
E_{21}\\
E_{22}\\
\vdots\\
E_{2n_2}\\
\vdots\\
E_{In_I}\end{pmatrix}. \quad$$`



---
template: model
## Sous forme matricielle
 `$$\bf{Y = X\theta + E}$$`
### Forme singuli√®re 

`$${\bf{Y}} = \overset{}{\begin{pmatrix}
Y_{11}\\
Y_{12}\\
Y_{13}\\
\vdots\\
Y_{1n_1}\\
Y_{21}\\
Y_{22}\\
\vdots\\
Y_{2n_2}\\
\vdots\\
Y_{In_I}\end{pmatrix}}, \quad
{\bf{X}} =\overset{\color{gray}{\begin{matrix}\mu &amp; \alpha_2 &amp; \ldots &amp; \ldots &amp;\alpha_I\end{matrix}}}{\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
\vdots\\
1 &amp; 0 &amp; 0 &amp; \ldots 0\\
1 &amp; 1 &amp; 0 &amp; \ldots 0 \\
1 &amp; 1 &amp; 0 &amp; \ldots 0 \\\vdots\\
1 &amp; 1 &amp; 0 &amp; \ldots 0 \\\vdots\\
1 &amp; 0 &amp; 0 &amp; \ldots 1 \end{pmatrix}}, \quad
{\bf{\theta}} =\begin{pmatrix}
\mu\\
\alpha\\
\vdots\\
\alpha_I\end{pmatrix}, \quad{\bf{E}} =\begin{pmatrix}
E_{11}\\
E_{12}\\
E_{13}\\
\vdots\\
E_{1n_1}\\
E_{21}\\
E_{22}\\
\vdots\\
E_{2n_2}\\
\vdots\\
E_{In_I}\end{pmatrix}. \quad$$`

---
count: false
template: model
## D√©clinaisons sur l'exemple 1 (fr√©quence cardiaque)

#### Donner les dimensions de `\(\bf{Y,\ X,\ \theta}\)`  et `\(\bf{E}\)` (nombre de lignes et de colonnes)

#### Ecrire `\(\theta\)`

#### Expliquer comment construire `\(\bf{X}\)`


.footnote[
 Pour un rappel sur le produit matriciel : [Wkipedia](https://fr.wikipedia.org/wiki/Produit_matriciel)
]

---
class: inverse
name: pause
# Pause

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;p style="color:#B40F20;font-size:35px;text-align:center;"&gt;Prenons une petite pause !!!&lt;/p&gt; 

---
name: parametre
# Etude des param√®tres du mod√®le

---
template: parametre
## Quelques pr√©cisions de notations et de vocabulaires

- Les donn√©es observ√©es (les valeurs prises par la variable `\(Y\)` ) : `\(\bf{y}=(y_{11}, y_{12}, \ldots, y_{I n_I}).\)` 

- En refaisant la m√™me exp√©rience, on obtiendrait d'autres valeurs (li√©es √†aux choix d'individus diff√©rents par exemple, ou mesur√© un autre jour, ...), on va noter `\(Y_{ik}\)` la variable al√©atoire qui d√©crit la loi des valeurs possibles pour l'individu k du groupe i.   

&lt;br&gt;
&lt;a class=care&gt; les minuscules notent des valeurs, les majuscules des variables al√©atoires. &lt;/a&gt;
&lt;br&gt;

--

Les param√®tres du mod√®le  sont inconnus. Ils sont not√©s par des lettres grecques `\(\bf{\theta}\)`, `\(\mu, \alpha, \dots\)`. 


On veut en donner une estimation √† partir des donn√©es observ√©es ( `\(\bf{y}\)`). Les estimations des param√®tres sont not√©es par les m√™mes lettres d√©cor√©es d'un chapeau `\(\bf{\hat{\theta}}, \hat{\mu}, \hat{\alpha}, \dots\)`.  


L'estimateur d'un param√®tre est la variable al√©atoire correspondante. Il sera not√© en majuscule avec une lettre latine. Par exemple, l'etimateur de `\(\theta\)` sera not√© `\(T\)`, l'estimateur de `\(\mu\)` sera not√© `\(M\)` et l'estimateur de `\(\alpha_1\)` sera not√© `\(A_1\)`.



---
template: parametre
## Estimation des param√®tres du mod√®le version r√©guli√®re

`$$Y_{ik} = \mu_i + E_{ik}, \quad E_{ik}\overset{ind}{\sim}\mathcal{N}(0,\sigma^2).$$`

### Estimation

`\(\mu_i\)` repr√©sente le comportement moyen de l'ensemble des individus du groupe `\(i\)`.  On peut l'estimer par `\(\hat{\mu}_i = \frac{1}{n_i}\sum_{k=1}^{n_i} y_{ik}\)`

--

### Estimateur 

L'estimateur de `\(\mu_i\)` est donc d√©fini par `\(M_i= \frac{1}{n_i}\sum_{k=1}^{n_i} Y_{ik},\)`  c'est une variable al√©atoire

--
- de loi normale (somme de variables normales)

--
- d'esp√©rance `\(\mathbb{E}(M_i) = \mathbb{E}\left( \frac{1}{n_i}\sum_{k=1}^{n_i} Y_{ik}\right) =  \frac{1}{n_i} \sum_{k=1}^{n_i} \mathbb{E}(Y_{ik}) =\mu_i.\)` 
--
&lt;a class=care&gt; C'est un estimateur sans biais&lt;/a&gt;
--

- de variance `\(\mathbb{V}(M_i) = \mathbb{V}\left( \frac{1}{n_i}\sum_{k=1}^{n_i} Y_{ik}\right) =  \frac{1}{n_i^2} \sum_{k=1}^{n_i} \mathbb{V}(Y_{ik}) = \frac{\sigma^2}{n_i}\)`
--
&lt;a class=care&gt; la variance de l'estimateur diminue quand le nombre de personnes dans le groupe augmente.&lt;/a&gt;
--

`$$M_i \sim\mathcal{N}\left(\mu_i, \frac{\sigma^2}{n_i}\right).$$`


---
template: parametre
## Estimation des param√®tres du mod√®le version singuli√®re avec la contrainte par d√©faut

`$$Y_{ik} = \mu + \alpha_i + E_{ik}, \quad E_{ik}\overset{ind}{\sim}\mathcal{N}(0,\sigma^2).$$`

### Estimation

- `\(\mu\)` repr√©sente le comportement moyen du groupe 1 (groupe de r√©f√©rence) : `\(\hat{\mu} = \frac{1}{n_1}\sum_{k=1}^{n_1} y_{1k}\)`
--

- `\(\mu + \alpha_i = \mu_i\)`, donc  `\(\alpha_i = \mu_i -\mu\)` ,repr√©sente l'effet diff√©rentiel du groupe i par rapport au groupe de r√©f√©rence.  `\(\hat{\alpha_i} = \frac{1}{n_i}\sum_{k=1}^{n_i} y_{1k} - \hat{\mu}\)`

--

### Estimateur 

L'estimateur de `\(\mu\)` est donc d√©fini par `\(M= \frac{1}{n_1}\sum_{k=1}^{n_1} Y_{1k}.\)`  

`$$M \sim\mathcal{N}\left(\mu, \frac{\sigma^2}{n_1}\right).$$`

--

L'estimateur de `\(\alpha_i\)` est donc d√©fini par `\(A_i= \frac{1}{n_i}\sum_{k=1}^{n_i} Y_{ik} - \frac{1}{n_1}\sum_{k=1}^{n_1} Y_{1k}.\)`

`$$A_i \sim\mathcal{N}\left(\alpha_i, \sigma^2\left(\frac{1}{n_i} + \frac{1}{n_1}\right) \right).$$`


---
template: parametre
## Estimation des param√®tres pour l'exemple 1.

### Ce qu'on doit trouver

`$$\hat{\mu} =\frac{1}{20}\sum_{k=1}^{20} y_{1k}, \quad \hat{\alpha}_2 =\frac{1}{20}\sum_{k=1}^{20} y_{2k} - \frac{1}{20}\sum_{k=1}^{20} y_{1k}$$`


```r
freqdata %&gt;% group_by(Sexe) %&gt;% summarise(m = mean(freqC), n= n())
```

```
[90m# A tibble: 2 x 3[39m
  Sexe      m     n
  [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m
[90m1[39m F      84.3    20
[90m2[39m M      84.6    20
```



--

`\(\hat{\mu} =\)` 84.3 et `\(\hat{\alpha}_2=\)` 0.25. 


---
count: false
template: parametre
## Estimation des param√®tres pour l'exemple 1.

### Ce qu'on doit trouver

`\(\hat{\mu} =\)` 84.3 et `\(\hat{\alpha}_2=\)` 0.25. 

--


### Estimer avec R


```r
M1 &lt;- lm(freqC ~ Sexe, data = freqdata)
summary(M1)$coefficients
```

```
            Estimate Std. Error    t value     Pr(&gt;|t|)
(Intercept)    84.30  0.9025913 93.3977539 1.649393e-46
SexeM           0.25  1.2764569  0.1958546 8.457675e-01
```

---
count: false
template: parametre
## Estimation des param√®tres pour l'exemple 1.


```r
M1 &lt;- lm(freqC ~ Sexe, data = freqdata)
summary(M1)
```

```

Call:
lm(formula = freqC ~ Sexe, data = freqdata)

Residuals:
   Min     1Q Median     3Q    Max 
-8.550 -2.737 -0.425  2.513  8.700 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  84.3000     0.9026  93.398   &lt;2e-16 ***
SexeM         0.2500     1.2765   0.196    0.846    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.037 on 38 degrees of freedom
Multiple R-squared:  0.001008,	Adjusted R-squared:  -0.02528 
F-statistic: 0.03836 on 1 and 38 DF,  p-value: 0.8458
```



---
template: parametre
## Retour sur la m√©thode d'estimation - Somme des carr√©s r√©siduel (RSS)

Naturellement, on a choisi d'estimer  `\(\mu_i\)` par `\(\frac{1}{n_i}\sum_{k=1}^{n_1} y_{ik}.\)` 

--

En fait, `\(\hat{\mu}_i\)` est choisi pour minimiser `\(RSS_{obs}\)`, la somme observ√©e des erreurs au carr√©  donn√©e par  

`$$RSS_{obs} = \sum_{i=1}^I \sum_{k=1}^{n_i} (y_{ik} - \hat{\mu}_i)^2.$$` 
--

Le mod√®le d'analyse de la variance 
`$$Y_{ik} =\mu_i +E_{ik}.$$`
Pour un nouvel individu `\(k_0\)` dans le groupe `\(i\)`, le mod√®le pr√©dit que sa fr√©quence cardiaque sera `\(\hat{y}_{ik_0}=\hat{\mu}_i\)`.

`\(RSS_{obs}\)` se r√©√©crit dans un cadre g√©n√©ral comme 

`$$RSS_{obs} = \sum_{i=1}^I \sum_{k=1}^{n_i} (y_{ik} - \hat{y}_{ik})^2.$$` 

`$$RSS = \sum_{i=1}^I \sum_{k=1}^{n_i} (Y_{ik} - \hat{Y}_{ik})^2.$$` 



---
template: parametre

## Loi de RSS

`$$\frac{RSS}{\sigma^2} \sim \chi^2(n-I).$$`


--

### D'o√π vient ce `\(n-I\)` ?

La variabilit√© totale des erreurs est donn√©e par 

`$$\sum_{i=1}^I \sum_{k=1}^{n_i} (Y_{ik} - \mu_i)^2= \sum_{i=1}^I \sum_{k=1}^{n_i} (E_{ik})^2,$$`
C'est la somme de n variables al√©aoires normales centr√©es de variance `\(\sigma^2\)`, donc 

`$$\sum_{i=1}^I \sum_{k=1}^{n_i} \left( \frac{E_{ik}}{\sigma}\right)^2 \sim\chi^2(n).$$`
--

Mais les `\(\mu_i\)` sont inconnus, on les remplace par leur estimateurs  `\(M_i.\)`

Chaque fois que l'on doit remplacer un param√®tre de moyenne par son estimateur, on perd un degr√© de libert√©. Ici on a estim√© `\(I\)` param√®tres de moyenne, d'o√π le `\(n-I\)`.




---
template: parametre
## Le param√®tre de variance

Rappel:

Si une variable `\(U\sim\chi^2(l)\)` alors `\(\mathbb{E}(U)=l\)`.

Alors `\(\mathbb{E}\left( \frac{RSS}{\sigma^2} \right) = n-I,\)` donc  `\(\mathbb{E}\left( \frac{RSS}{n-I} \right) = \sigma^2.\)`

--

## Estimateur de la variance 

  $$S^2 =\frac{1}{n-I} RSS, $$
est un &lt;a class=care&gt; estimateur sans bias de  `\(\sigma^2\)` &lt;/a&gt; .

--

## Estimation de `\(\sigma^2\)`

`$$\hat{\sigma}^2 =\frac{1}{n-I} RSS_{obs}.$$`


---





count: false
 

.panel1-var_est-user[

```r
*freqdata %&gt;%  group_by(Sexe)
```
]
 
.panel2-var_est-user[

```
[90m# A tibble: 40 x 3[39m
[90m# Groups:   Sexe [2][39m
  freqC Sport Sexe 
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m
[90m1[39m    82     1 M    
[90m2[39m    82     1 F    
[90m3[39m    77     1 M    
[90m4[39m    79     1 F    
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-var_est-user[

```r
freqdata %&gt;%  group_by(Sexe) %&gt;%
* mutate(yhat =  mean(freqC))
```
]
 
.panel2-var_est-user[

```
[90m# A tibble: 40 x 4[39m
[90m# Groups:   Sexe [2][39m
  freqC Sport Sexe   yhat
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m    82     1 M      84.6
[90m2[39m    82     1 F      84.3
[90m3[39m    77     1 M      84.6
[90m4[39m    79     1 F      84.3
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-var_est-user[

```r
freqdata %&gt;%  group_by(Sexe) %&gt;%
  mutate(yhat =  mean(freqC)) %&gt;%
* mutate( Ehat = freqC-yhat,Ehat_2 = Ehat^2)
```
]
 
.panel2-var_est-user[

```
[90m# A tibble: 40 x 6[39m
[90m# Groups:   Sexe [2][39m
  freqC Sport Sexe   yhat  Ehat Ehat_2
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m    82     1 M      84.6 -[31m2[39m[31m.[39m[31m55[39m   6.50
[90m2[39m    82     1 F      84.3 -[31m2[39m[31m.[39m[31m30[39m   5.29
[90m3[39m    77     1 M      84.6 -[31m7[39m[31m.[39m[31m55[39m  57.0 
[90m4[39m    79     1 F      84.3 -[31m5[39m[31m.[39m[31m30[39m  28.1 
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-var_est-user[

```r
freqdata %&gt;%  group_by(Sexe) %&gt;%
  mutate(yhat =  mean(freqC)) %&gt;%
  mutate( Ehat = freqC-yhat,Ehat_2 = Ehat^2) %&gt;%
* ungroup %&gt;% summarise(RSSobs=sum(Ehat_2)) %&gt;% as.numeric() -&gt; RSSobs
*RSSobs
```
]
 
.panel2-var_est-user[

```
[1] 619.15
```
]

---
count: false
 

.panel1-var_est-user[

```r
freqdata %&gt;%  group_by(Sexe) %&gt;%
  mutate(yhat =  mean(freqC)) %&gt;%
  mutate( Ehat = freqC-yhat,Ehat_2 = Ehat^2) %&gt;%
  ungroup %&gt;% summarise(RSSobs=sum(Ehat_2)) %&gt;% as.numeric() -&gt; RSSobs
RSSobs
*sigma2_hat &lt;- RSSobs / (nrow(freqdata) - 2)
*sigma2_hat
```
]
 
.panel2-var_est-user[

```
[1] 619.15
```

```
[1] 16.29342
```
]

---
count: false
 

.panel1-var_est-user[

```r
freqdata %&gt;%  group_by(Sexe) %&gt;%
  mutate(yhat =  mean(freqC)) %&gt;%
  mutate( Ehat = freqC-yhat,Ehat_2 = Ehat^2) %&gt;%
  ungroup %&gt;% summarise(RSSobs=sum(Ehat_2)) %&gt;% as.numeric() -&gt; RSSobs
RSSobs
sigma2_hat &lt;- RSSobs / (nrow(freqdata) - 2)
sigma2_hat
*sigma_hat &lt;- sqrt(sigma2_hat)
*sigma_hat
```
]
 
.panel2-var_est-user[

```
[1] 619.15
```

```
[1] 16.29342
```

```
[1] 4.036511
```
]

&lt;style&gt;
.panel1-var_est-user {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-var_est-user {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-var_est-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

template: parametre
## Estimation du param√®tre de variance sur l'exemple 1

### On doit trouver

`\(\hat{\sigma}=\)` 4.036511.


--

### Avec R



```r
M1 &lt;- lm(freqC ~ Sexe, data = freqdata)
```

--


```r
summary(M1)$sigma
```

```
[1] 4.036511
```

---
count: false
template: parametre
## Estimation du param√®tre de variance sur l'exemple 1

### On doit trouver

`\(\hat{\sigma}=\)` 4.036511.




```r
summary(M1)
```

```

Call:
lm(formula = freqC ~ Sexe, data = freqdata)

Residuals:
   Min     1Q Median     3Q    Max 
-8.550 -2.737 -0.425  2.513  8.700 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  84.3000     0.9026  93.398   &lt;2e-16 ***
SexeM         0.2500     1.2765   0.196    0.846    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.037 on 38 degrees of freedom
Multiple R-squared:  0.001008,	Adjusted R-squared:  -0.02528 
F-statistic: 0.03836 on 1 and 38 DF,  p-value: 0.8458
```


---
template: parametre
## Visualisation graphique des param√®tres estim√©es



---

count: false

&lt;img src="anova_files/figure-html/anova_visu_par_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova_files/figure-html/anova_visu_par_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova_files/figure-html/anova_visu_par_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-anova_visu_par-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-anova_visu_par-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-anova_visu_par-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;




---
template: parametre
## Estimation des param√®tres du mod√®le version matricielle


Le mod√®le sous forme matricielle s'√©crit

`$$\bf{Y = X\theta + E}.$$`
--

### Estimation de `\(\theta\)`

`$$\hat{\theta} = (X^\intercal X )^{-1} X^\intercal Y_{obs}.$$`

--

### Estimateur de `\(\theta\)`

`$$\hat{\theta} = (X^\intercal X )^{-1} X^\intercal Y.$$`
--

### Loi de l'estimateur de `\(\theta\)`


`$$T = (X^\intercal X )^{-1} X^\intercal Y \sim \mathcal{N}_{I}\left(\theta, \sigma^2 (X^\intercal X )^{-1}\right).$$`
--

Cette approche tr√®s math√©matique est utile pour la g√©n√©ralisation, on aura l'occasion d'y revenir !!

---
template: parametre
### D√©clinaison sur les exemples

A partir des donn√©es de chauve souris, ajuster un mod√®le  permettant d'expliquer le volume de la partie Auditive (AUD) en fonction du r√©gime.

Il ne s'agit pas de refaire les calculs √† la main, mais uniquement d'utiliser la fonction `lm`. 
### M√©fiez vous 

- v√©rifier les degr√©s de libert√© et le nom des param√®tres
- Si quelque chose cloche, v√©rifier la nature de la variable Diet
- On peut transformer une variable en facteur √† l'aide de la fonction `as.factor`.


---
template: pause

---
name: modcomp
# Test du mod√®le complet


---
template: modcomp
## Rappel exemple fr√©quence cardiaque (exemple 1)

On a mesur√© la fr√©quence cardiaque de 20 femmes et 20 hommes.



&lt;img src="anova_files/figure-html/freqdata2-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


--
&lt;p class="question"&gt; Les hommes et les femmes ont-ils la m√™me fr√©quence cardiaque au repos ?&lt;/p&gt;

---
template: modcomp
## Rappel exemple fr√©quence cardiaque (exemple 1)


&lt;p class="question"&gt; Les hommes et les femmes ont-ils la m√™me fr√©quence cardiaque au repos ?&lt;/p&gt;


Autrement dit


&lt;img src="anova_files/figure-html/freqdata_graphia_anova-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: modcomp
## Test de l'existence d'un effet


&lt;p class="question"&gt; Le comportement moyen de la variable `\(Y\)` est il diff√©rent selon les diff√©rentes modalit√©s de la variable explicative ?&lt;/p&gt;

--

Deux mod√®les possibles
`$$M1 : Y_{ik} = \mu =\alpha_i + E_{ik},\quad  M0: Y_{ik} = \mu  + E_{ik}$$`

&lt;p class="question"&gt; Le mod√®le M1 est il plus pertinent que le mod√®le M0?&lt;/p&gt;


---
template: modcomp
## Mesurer la variabilit√© expliqu√©e par le mod√®le M1

--

### Variabilit√© totale dans les donn√©es

`$$RSS_{0, obs} = \sum_{i=1}^{I} \sum_{k=1}^{n_i} (y_{ik} - \bar{y})^2.$$` 
--

### Variabilit√© r√©siduelle dans le mod√®le M1

`$$RSS_{1, obs} = \sum_{i=1}^{I} \sum_{k=1}^{n_i} (y_{ik} - \hat{y}_{ik})^2.$$` 
--

### Variabilit√© expliqu√©e par le mod√®le M1

`$$SS_{M1,obs} =  RSS_{0, obs} - RSS_{1, obs}.$$` 
C'est la quantit√© de variabilit√© expliqu√©e par les diff√©rence entre les I populations.

--

&lt;p class=care&gt; Si la variabilit√© expliqu√©e par le mod√®le `\(M1\)` est grande, on gagne √† consid√©rer des ppopulations diff√©rentes &lt;p&gt;

On a mis en √©vidence des diff√©rences entre les populations.


---
## Calcul de RSS sur l'exemple 1
 A la main :





--- 

count: false
 

.panel1-rss-auto[

```r
*freqdata %&gt;% group_by(Sexe)
```
]
 
.panel2-rss-auto[

```
[90m# A tibble: 40 x 3[39m
[90m# Groups:   Sexe [2][39m
  freqC Sport Sexe 
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m
[90m1[39m    82     1 M    
[90m2[39m    82     1 F    
[90m3[39m    77     1 M    
[90m4[39m    79     1 F    
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
* mutate(m= mean(freqC))
```
]
 
.panel2-rss-auto[

```
[90m# A tibble: 40 x 4[39m
[90m# Groups:   Sexe [2][39m
  freqC Sport Sexe      m
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m    82     1 M      84.6
[90m2[39m    82     1 F      84.3
[90m3[39m    77     1 M      84.6
[90m4[39m    79     1 F      84.3
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
* mutate( Ehat = freqC - m)
```
]
 
.panel2-rss-auto[

```
[90m# A tibble: 40 x 5[39m
[90m# Groups:   Sexe [2][39m
  freqC Sport Sexe      m  Ehat
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m    82     1 M      84.6 -[31m2[39m[31m.[39m[31m55[39m
[90m2[39m    82     1 F      84.3 -[31m2[39m[31m.[39m[31m30[39m
[90m3[39m    77     1 M      84.6 -[31m7[39m[31m.[39m[31m55[39m
[90m4[39m    79     1 F      84.3 -[31m5[39m[31m.[39m[31m30[39m
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
* mutate( E2hat = Ehat^2)
```
]
 
.panel2-rss-auto[

```
[90m# A tibble: 40 x 6[39m
[90m# Groups:   Sexe [2][39m
  freqC Sport Sexe      m  Ehat E2hat
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m    82     1 M      84.6 -[31m2[39m[31m.[39m[31m55[39m  6.50
[90m2[39m    82     1 F      84.3 -[31m2[39m[31m.[39m[31m30[39m  5.29
[90m3[39m    77     1 M      84.6 -[31m7[39m[31m.[39m[31m55[39m 57.0 
[90m4[39m    79     1 F      84.3 -[31m5[39m[31m.[39m[31m30[39m 28.1 
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
* ungroup()
```
]
 
.panel2-rss-auto[

```
[90m# A tibble: 40 x 6[39m
  freqC Sport Sexe      m  Ehat E2hat
  [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;int&gt;[39m[23m [3m[90m&lt;chr&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m    82     1 M      84.6 -[31m2[39m[31m.[39m[31m55[39m  6.50
[90m2[39m    82     1 F      84.3 -[31m2[39m[31m.[39m[31m30[39m  5.29
[90m3[39m    77     1 M      84.6 -[31m7[39m[31m.[39m[31m55[39m 57.0 
[90m4[39m    79     1 F      84.3 -[31m5[39m[31m.[39m[31m30[39m 28.1 
[90m# ‚Ä¶ with 36 more rows[39m
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
* summarise(RSSM1 =sum(E2hat))
```
]
 
.panel2-rss-auto[

```
[90m# A tibble: 1 x 1[39m
  RSSM1
  [3m[90m&lt;dbl&gt;[39m[23m
[90m1[39m  619.
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
* RSSM1
```
]
 
.panel2-rss-auto[

]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM1
*freqdata %&gt;%  mutate(m= mean(freqC))
```
]
 
.panel2-rss-auto[

```
   freqC Sport Sexe      m
1     82     1    M 84.425
2     82     1    F 84.425
3     77     1    M 84.425
4     79     1    F 84.425
5     81     1    M 84.425
6     83     1    F 84.425
7     76     1    M 84.425
8     80     1    F 84.425
9     80     2    M 84.425
10    83     2    F 84.425
11    83     2    M 84.425
12    81     2    F 84.425
13    81     2    M 84.425
14    84     2    F 84.425
15    80     2    M 84.425
16    82     2    F 84.425
17    88     3    M 84.425
18    81     3    F 84.425
19    87     3    M 84.425
20    83     3    F 84.425
21    86     3    M 84.425
22    83     3    F 84.425
23    87     3    M 84.425
24    83     3    F 84.425
25    85     4    M 84.425
26    85     4    F 84.425
27    84     4    M 84.425
28    86     4    F 84.425
29    87     4    M 84.425
30    87     4    F 84.425
31    85     4    M 84.425
32    85     4    F 84.425
33    92     5    M 84.425
34    88     5    F 84.425
35    91     5    M 84.425
36    93     5    F 84.425
37    90     5    M 84.425
38    88     5    F 84.425
39    89     5    M 84.425
40    90     5    F 84.425
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM1
freqdata %&gt;%  mutate(m= mean(freqC)) %&gt;%
* mutate( Ehat = freqC - m)
```
]
 
.panel2-rss-auto[

```
   freqC Sport Sexe      m   Ehat
1     82     1    M 84.425 -2.425
2     82     1    F 84.425 -2.425
3     77     1    M 84.425 -7.425
4     79     1    F 84.425 -5.425
5     81     1    M 84.425 -3.425
6     83     1    F 84.425 -1.425
7     76     1    M 84.425 -8.425
8     80     1    F 84.425 -4.425
9     80     2    M 84.425 -4.425
10    83     2    F 84.425 -1.425
11    83     2    M 84.425 -1.425
12    81     2    F 84.425 -3.425
13    81     2    M 84.425 -3.425
14    84     2    F 84.425 -0.425
15    80     2    M 84.425 -4.425
16    82     2    F 84.425 -2.425
17    88     3    M 84.425  3.575
18    81     3    F 84.425 -3.425
19    87     3    M 84.425  2.575
20    83     3    F 84.425 -1.425
21    86     3    M 84.425  1.575
22    83     3    F 84.425 -1.425
23    87     3    M 84.425  2.575
24    83     3    F 84.425 -1.425
25    85     4    M 84.425  0.575
26    85     4    F 84.425  0.575
27    84     4    M 84.425 -0.425
28    86     4    F 84.425  1.575
29    87     4    M 84.425  2.575
30    87     4    F 84.425  2.575
31    85     4    M 84.425  0.575
32    85     4    F 84.425  0.575
33    92     5    M 84.425  7.575
34    88     5    F 84.425  3.575
35    91     5    M 84.425  6.575
36    93     5    F 84.425  8.575
37    90     5    M 84.425  5.575
38    88     5    F 84.425  3.575
39    89     5    M 84.425  4.575
40    90     5    F 84.425  5.575
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM1
freqdata %&gt;%  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
* mutate( E2hat = Ehat^2)
```
]
 
.panel2-rss-auto[

```
   freqC Sport Sexe      m   Ehat     E2hat
1     82     1    M 84.425 -2.425  5.880625
2     82     1    F 84.425 -2.425  5.880625
3     77     1    M 84.425 -7.425 55.130625
4     79     1    F 84.425 -5.425 29.430625
5     81     1    M 84.425 -3.425 11.730625
6     83     1    F 84.425 -1.425  2.030625
7     76     1    M 84.425 -8.425 70.980625
8     80     1    F 84.425 -4.425 19.580625
9     80     2    M 84.425 -4.425 19.580625
10    83     2    F 84.425 -1.425  2.030625
11    83     2    M 84.425 -1.425  2.030625
12    81     2    F 84.425 -3.425 11.730625
13    81     2    M 84.425 -3.425 11.730625
14    84     2    F 84.425 -0.425  0.180625
15    80     2    M 84.425 -4.425 19.580625
16    82     2    F 84.425 -2.425  5.880625
17    88     3    M 84.425  3.575 12.780625
18    81     3    F 84.425 -3.425 11.730625
19    87     3    M 84.425  2.575  6.630625
20    83     3    F 84.425 -1.425  2.030625
21    86     3    M 84.425  1.575  2.480625
22    83     3    F 84.425 -1.425  2.030625
23    87     3    M 84.425  2.575  6.630625
24    83     3    F 84.425 -1.425  2.030625
25    85     4    M 84.425  0.575  0.330625
26    85     4    F 84.425  0.575  0.330625
27    84     4    M 84.425 -0.425  0.180625
28    86     4    F 84.425  1.575  2.480625
29    87     4    M 84.425  2.575  6.630625
30    87     4    F 84.425  2.575  6.630625
31    85     4    M 84.425  0.575  0.330625
32    85     4    F 84.425  0.575  0.330625
33    92     5    M 84.425  7.575 57.380625
34    88     5    F 84.425  3.575 12.780625
35    91     5    M 84.425  6.575 43.230625
36    93     5    F 84.425  8.575 73.530625
37    90     5    M 84.425  5.575 31.080625
38    88     5    F 84.425  3.575 12.780625
39    89     5    M 84.425  4.575 20.930625
40    90     5    F 84.425  5.575 31.080625
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM1
freqdata %&gt;%  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
* summarise(RSSM1 =sum(E2hat))
```
]
 
.panel2-rss-auto[

```
    RSSM1
1 619.775
```
]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM1
freqdata %&gt;%  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
* RSSM0
```
]
 
.panel2-rss-auto[

]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM1
freqdata %&gt;%  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM0
*SSM &lt;- as.numeric(RSSM0 - RSSM1)
```
]
 
.panel2-rss-auto[

]

---
count: false
 

.panel1-rss-auto[

```r
freqdata %&gt;% group_by(Sexe) %&gt;%
  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  ungroup() %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM1
freqdata %&gt;%  mutate(m= mean(freqC)) %&gt;%
  mutate( Ehat = freqC - m) %&gt;%
  mutate( E2hat = Ehat^2) %&gt;%
  summarise(RSSM1 =sum(E2hat)) -&gt;
  RSSM0
SSM &lt;- as.numeric(RSSM0 - RSSM1)
*SSM
```
]
 
.panel2-rss-auto[

```
[1] 0.625
```
]

&lt;style&gt;
.panel1-rss-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-rss-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-rss-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





```
[1] 0.625
```

---
## Calcul de RSS sur l'exemple 1



```r
M1 &lt;- lm(freqC ~ Sexe, data= freqdata)
M0 &lt;- lm(freqC ~ 1, data= freqdata)
anova(M0, M1)
```

```
Analysis of Variance Table

Model 1: freqC ~ 1
Model 2: freqC ~ Sexe
  Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
1     39 619.77                           
2     38 619.15  1     0.625 0.0384 0.8458
```



---
template: modcomp
## Quand d√©cider si `\(SS_{M1, obs}\)` est grande ?  


--
C'est le r√¥le du test statistique.

--

Id√©e de d√©marche:

- D√©crire quelle gamme de valeurs pourrait prendre SSM dans le cas o√π il n'y pas de diff√©rence entre les groupes 
- Comparer avec ce qu'on constate sur nos donn√©es
- 
    - Si c'est comparable, pas de raison de penser qu'il y a des diff√©rences entre les groupes,
    - Si c'est surprenant, les groupes sont vraisemblablement diff√©rentes.

--

On veut d√©crire comment varie `\(SS_{M1, obs}\)` dans la situation o√π il n"y a pas de diff√©rence entre les groupes.

On travaille donc sous l'hypoth√®se 
`$$H_0 =\left \lbrace \mbox{Pas de diff√©rence entre les groupes }\right\rbrace$$`

--

`$$H_0 =\left \lbrace  \mbox{pour tout }i, \alpha_i =0  \right\rbrace$$`

--

`$$H_0 =\left \lbrace  M1 \mbox{ est √©quivalent √† } M0 \right\rbrace.$$`

---
template: modcomp
## Hypoth√®ses du test

On va donc opposer une hypoth√®se de travail `\(H_0\)` contre une hypoth√®se alternative `\(H_1\)`. `\(H_0\)` peut donc prendre diff√©rentes formes:


`$$\begin{align} 
H_0 &amp; =\left \lbrace \mbox{Pas de diff√©rence entre les groupes }\right\rbrace\\
    &amp; =\left \lbrace  \mbox{pour tout }i, \alpha_i =0  \right\rbrace\\
    &amp; =\left \lbrace  M1 \mbox{ est √©quivalent √† } M0 \right\rbrace.
\end{align}$$`

`\(H_1\)` prend les formes √©quivalentes suivantes

`$$\begin{align} 
H_1 &amp; =\left \lbrace \mbox{Au moins 1 groupe est diff√©rent des autres}\right\rbrace\\
    &amp; =\left \lbrace  \mbox{Il existe un }i, \alpha_i  \ne 0  \right\rbrace\\
    &amp; =\left \lbrace  M1 \mbox{ est pr√©f√©rable √† } M0 \right\rbrace.
\end{align}$$`
---
## Loi de la statistique de test sous H0


Il faut √™tre capable de d√©crire quelles sont les valeurs possibles de `\(SS_{M1, obs}\)`, pour ceci il faut connaitre la loi de la variable al√©atoire `\(SS_{M1}\)`.

-
On peut montrer que sous `\(H_0\)`,  

`$$\frac{SS_{M1}}{\sigma^2} \underset{H_0}{\sim}\chi^2(I-1)$$`  

--
Mais `\(\sigma^2\)` est inconnu, on a envie de le remplacer par son estimateur `\(RSS / (n-I).\)`

--


&lt;p class=question&gt; 
Sous `\(H_0\)`, 
`$$F= \frac{\frac{SS_{M1}}{I-1}}{\frac{RSS}{n-I}} \underset{H_0}{\sim}\mathcal{F}(I-1, n-I)$$`  
&lt;/p&gt;




---
template: modcomp
## Loi de la statistique de test sous H0 - graphiquement

Sous `\(H0\)` la loi de distribution de `\(F\)` est 



--- 

Si on a observ√© `\(Fobs\)`, comment savaoir si--


## D√©clinaison sur les exemples

---
template: pause

---

# Test sur un param√®tre

## R√©flexion sur le sens de ce test

## loi de la statistique de test

## D√©clinaison sur les exemples

---
# V√©rification graphique des hypoth√®ses de mod√©lisation


---
# D√©marche compl√®te d'analyse √† partir de l'exemple des chauves souris




---
template: pause

Avant de passer √† l'analyse de variance √† deux facteurs
---



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../resources/collapseoutput.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:10",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-image: url(img/sticker_sotr.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  bottom: 1em;
  right: 1em;
  width: 66px;
  height: 78px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
